<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
    </head>
    <body style="font-family: sans-serif;">
        <h2>Weekly Shul Updates</h2>
        <p>
            {{ shuls|length }} shul(s) updated
            {% if deleted_shuls %}, {{ deleted_shuls|length }} shul(s) deleted{% endif %}
        </p>
        {% if shuls %}
            <h3>Updated Shuls</h3>
            <table style="border-collapse:collapse;width:100%;margin-bottom:30px;">
                <thead>
                    <tr style="background:#f0f0f0;">
                        <th style="border:1px solid #ccc;padding:8px;text-align:left;">Shul</th>
                        <th style="border:1px solid #ccc;padding:8px;text-align:left;">Room</th>
                        <th style="border:1px solid #ccc;padding:8px;text-align:left;">Size</th>
                        <th style="border:1px solid #ccc;padding:8px;text-align:left;">Vis/Aud</th>
                        <th style="border:1px solid #ccc;padding:8px;text-align:left;">Updated At</th>
                        <th style="border:1px solid #ccc;padding:8px;text-align:left;">Country</th>
                    </tr>
                </thead>
                <tbody>
                    {% for shul in shuls %}
                        {% with room_count=shul.rooms|length|default:1 %}
                            {% if shul.rooms %}
                                {% for room in shul.rooms %}
                                    <tr>
                                        {% if forloop.first %}
                                            <td rowspan="{{ room_count }}"
                                                style="vertical-align:top;
                                                       border:1px solid #ccc;
                                                       padding:8px">
                                                <a href="{{ shul.map_url }}">{{ shul.name }}</a>
                                            </td>
                                        {% endif %}
                                        <td style="border:1px solid #ccc;padding:8px;">{{ room.name }}</td>
                                        <td style="border:1px solid #ccc;padding:8px;">{{ room.size }}</td>
                                        <td style="border:1px solid #ccc;padding:8px;">{{ room.stars }}</td>
                                        {% if forloop.first %}
                                            <td rowspan="{{ room_count }}"
                                                style="vertical-align:top;
                                                       border:1px solid #ccc;
                                                       padding:8px">{{ shul.updated_at }}</td>
                                            <td rowspan="{{ room_count }}"
                                                style="vertical-align:top;
                                                       border:1px solid #ccc;
                                                       padding:8px">{{ shul.country }}</td>
                                        {% endif %}
                                    </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td style="border:1px solid #ccc;padding:8px;">
                                        <a href="{{ shul.map_url }}">{{ shul.name }}</a>
                                    </td>
                                    <td style="border:1px solid #ccc;padding:8px;">
                                        <em>(no rooms)</em>
                                    </td>
                                    <td style="border:1px solid #ccc;padding:8px;">-</td>
                                    <td style="border:1px solid #ccc;padding:8px;">-</td>
                                    <td style="border:1px solid #ccc;padding:8px;">{{ shul.updated_at }}</td>
                                    <td style="border:1px solid #ccc;padding:8px;">{{ shul.country }}</td>
                                </tr>
                            {% endif %}
                        {% endwith %}
                    {% endfor %}
                </tbody>
            </table>
        {% endif %}
        {% if deleted_shuls %}
            <h3 style="color:#dc3545;">Deleted Shuls</h3>
            <p>
                (<a href="{{ deleted_shuls_admin_url }}">View and manage in admin</a>)
            </p>
            <table style="border-collapse:collapse;width:100%;margin-bottom:30px;">
                <thead>
                    <tr style="background:#fff3cd;">
                        <th style="border:1px solid #ccc;padding:8px;text-align:left;">Shul</th>
                        <th style="border:1px solid #ccc;padding:8px;text-align:left;">Reason</th>
                        <th style="border:1px solid #ccc;padding:8px;text-align:left;">Deleted By</th>
                        <th style="border:1px solid #ccc;padding:8px;text-align:left;">Deleted At</th>
                        <th style="border:1px solid #ccc;padding:8px;text-align:left;">Country</th>
                    </tr>
                </thead>
                <tbody>
                    {% for shul in deleted_shuls %}
                        <tr>
                            <td style="border:1px solid #ccc;padding:8px;">
                                <strong>{{ shul.name }}</strong>
                            </td>
                            <td style="border:1px solid #ccc;padding:8px;">
                                {% if shul.deletion_reason %}
                                    {{ shul.deletion_reason }}
                                {% else %}
                                    <em>(No reason provided)</em>
                                {% endif %}
                            </td>
                            <td style="border:1px solid #ccc;padding:8px;">{{ shul.deleted_by }}</td>
                            <td style="border:1px solid #ccc;padding:8px;">{{ shul.deleted_at|date:"M d, Y, g:i a" }}</td>
                            <td style="border:1px solid #ccc;padding:8px;">{{ shul.country }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% endif %}
        <p style="color:#666;font-size:12px;margin-top:20px;">Automated message from ezratnashim.com</p>
    </body>
</html>
