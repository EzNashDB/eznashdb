{# Shared accordion item for a single shul - used by both cluster and exact pin popups #}
{# Parameters: shul, accordion_id, item_id_prefix, total_shuls (optional), is_expanded (optional bool), is_last (optional bool) #}
<div class="accordion-item border-0"
     x-init="SHUL_MAP_API.initShulAccordion($el, {{ shul.pk }})">
    <h2 class="accordion-header" style="scroll-margin-top: 15px">
        <button class="accordion-button
                       {% if total_shuls > 1 and not is_expanded %}collapsed{% endif %}"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#{{ item_id_prefix }}-{{ shul.id }}"
                aria-expanded="{% if total_shuls == 1 or is_expanded %}
                                   true
                               {% else %}
                                   false
                               {% endif %}"
                aria-controls="{{ item_id_prefix }}-{{ shul.id }}">
            <div class="d-flex w-100 pe-3 align-items-center">
                <span class="fw-bold d-inline-block flex-grow-1">
                    <div class="h5 m-0 d-inline-block">{{ shul.name }}</div>
                </span>
                <span>
                    <div class="badge text-bg-secondary">{{ shul.rooms.count }} Room{{ shul.rooms.count|pluralize }}</div>
                </span>
            </div>
        </button>
    </h2>
    <div id="{{ item_id_prefix }}-{{ shul.id }}"
         class="accordion-collapse collapse
                {% if total_shuls == 1 or is_expanded %}show{% endif %}"
         data-bs-parent="#{{ accordion_id }}">
        <div class="accordion-body">
            <div class="d-flex flex-column">
                <div class="d-flex flex-wrap gap-2 align-items-end">
                    <a class="btn btn-sm btn-outline-primary text-nowrap"
                       href="{% url 'eznashdb:update_shul' shul.id %}">
                        <i class="fa-solid fa-pen-to-square"></i> Edit
                    </a>
                    <a target="_blank"
                       rel="noopener noreferrer"
                       href="{% url 'eznashdb:google_maps_proxy' %}?id={{ shul.pk }}"
                       class="btn btn-sm btn-primary">
                        <i class="fa-brands fa-google me-1"></i>
                        Get Directions
                    </a>
                    <div class="flex-grow-1 text-end ms-auto small fst-italic text-muted">
                        Updated <span data-utc="{{ shul.updated_at|date:'c' }}"
       x-init="$el.textContent = new Date($el.dataset.utc).toLocaleString(undefined, {dateStyle: 'medium'})"></span>
                    </div>
                </div>
                {% if shul.rooms.exists %}
                    <ul class="list-group mt-3">
                        {% for room in shul.rooms.all %}
                            <li class="list-group-item">
                                <div class="h6 fw-bold">{{ room.name }}</div>
                                {% with not_set_display="<kbd class=\"fw-bold\">?</kbd> - Not set" %}
                                {% include "eznashdb/includes/room_metrics.html" with room=room not_set_display=not_set_display vis_col_class='col-5' size_col_class='col-7' layout='compact' %}
                            {% endwith %}
                        </li>
                    {% endfor %}
                </ul>
            {% endif %}
        </div>
    </div>
</div>
{% if not is_last %}<hr class="my-0 text-secondary-subtle" />{% endif %}
